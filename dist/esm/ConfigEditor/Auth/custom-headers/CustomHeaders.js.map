{"version":3,"file":"CustomHeaders.js","sources":["../../../../../src/ConfigEditor/Auth/custom-headers/CustomHeaders.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { css } from '@emotion/css';\nimport { Button, useTheme2 } from '@grafana/ui';\nimport { CustomHeader } from './CustomHeader';\nimport { ConfigSubSection } from '../../ConfigSection';\nimport type { Header, HeaderWithValue, LocalHeader } from '../types';\n\nexport type Props = {\n  headers: Header[];\n  onChange: (headers: HeaderWithValue[]) => void;\n  readOnly: boolean;\n};\n\nexport const CustomHeaders: React.FC<Props> = ({ headers: headersFromProps, onChange, readOnly }) => {\n  const { spacing } = useTheme2();\n\n  const [headers, setHeaders] = useState<LocalHeader[]>(\n    headersFromProps.map((header) => ({\n      ...header,\n      id: uniqueId(),\n      value: '',\n    }))\n  );\n\n  useEffect(() => {\n    setHeaders((headers) => {\n      let changed = false;\n      const newHeaders = headers.map<LocalHeader>((header) => {\n        const configured = headersFromProps.find((h) => h.name === header.name)?.configured;\n        if (typeof configured !== 'undefined' && header.configured !== configured) {\n          changed = true;\n          return { ...header, configured };\n        }\n        return header;\n      });\n\n      if (changed) {\n        return newHeaders;\n      }\n\n      return headers;\n    });\n  }, [headersFromProps]);\n\n  const onHeaderAdd = () => {\n    setHeaders([...headers, { id: uniqueId(), name: '', value: '', configured: false }]);\n  };\n\n  const onHeaderChange = (id: string, header: LocalHeader) => {\n    setHeaders(headers.map((h) => (h.id === id ? { ...header } : h)));\n  };\n\n  const onHeaderDelete = (id: string) => {\n    const index = headers.findIndex((h) => h.id === id);\n    if (index === -1) {\n      return;\n    }\n    const newHeaders = [...headers];\n    newHeaders.splice(index, 1);\n    setHeaders(newHeaders);\n    onChange(\n      newHeaders.map(({ name, value, configured }) => ({\n        name,\n        value,\n        configured,\n      }))\n    );\n  };\n\n  const onBlur = () => {\n    onChange(\n      headers.map(({ name, value, configured }) => ({\n        name,\n        value,\n        configured,\n      }))\n    );\n  };\n\n  const styles = {\n    container: css({\n      marginTop: spacing(3),\n    }),\n    addHeaderButton: css({\n      marginTop: spacing(1.5),\n    }),\n  };\n\n  return (\n    <div className={styles.container}>\n      <ConfigSubSection\n        title=\"HTTP headers\"\n        description=\"Pass along additional context and metadata about the request/response\"\n        isCollapsible\n        isInitiallyOpen={headers.length > 0}\n      >\n        <div>\n          {headers.map((header) => (\n            <CustomHeader\n              key={header.id}\n              header={header}\n              onChange={(header) => onHeaderChange(header.id, header)}\n              onDelete={() => onHeaderDelete(header.id)}\n              onBlur={onBlur}\n              readOnly={readOnly}\n            />\n          ))}\n        </div>\n        <div className={styles.addHeaderButton}>\n          <Button icon=\"plus\" variant=\"secondary\" fill=\"outline\" onClick={onHeaderAdd} disabled={readOnly}>\n            {headers.length === 0 ? 'Add header' : 'Add another header'}\n          </Button>\n        </div>\n      </ConfigSubSection>\n    </div>\n  );\n};\n\nfunction uniqueId(): string {\n  return Math.random().toString(16).slice(2);\n}\n"],"names":["headers","React","header"],"mappings":"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"}